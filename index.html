<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #loading {
            font-size: 20px;
            color: gray;
        }
        table {
            margin: 0 auto;
            border-collapse: collapse;
            width: 80%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Agenda Viewer</h1>
    <div id="loading">Loading...</div>

    <div>
        <button id="prev-day">Previous Day</button>
        <button id="next-day">Next Day</button>
    </div>

    <h2 id="current-date">Date: Loading...</h2>

    <table id="agenda-table" style="display:none;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Agenda</th>
            </tr>
        </thead>
        <tbody>
            <!-- Agenda items will be inserted here -->
        </tbody>
    </table>

    <script>
        let currentDate = new Date(); // Default to today
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSN4eos4Ca20oFbWLWqMWiz-6yC4Ao5tuGhpTy-1ox2bmASZGyAi3L0VGoHIJQkddo-RUCyoK3UcOCY/pub?output=csv";

        // Format date as "M/D/YYYY"
        function formatDateToString(date) {
            return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
        }

        // Fetch and parse CSV data
        async function fetchCSVData() {
            try {
                const response = await fetch(`${csvUrl}&nocache=${Math.random()}`);
                const csvText = await response.text();
                return parseCSV(csvText);
            } catch (error) {
                console.error("Error fetching CSV data:", error);
                return [];
            }
        }

        // Parse CSV text into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.split("\n");
            const headers = lines[0].split(",").map(header => header.trim().toLowerCase());
            return lines.slice(1).map(line => {
                const cols = line.split(",");
                return {
                    date: cols[0].trim(),
                    agenda: cols[1] ? cols[1].trim() : ""
                };
            });
        }

        // Display agenda for a given date
        async function displayAgendaForDate(date) {
            const formattedDate = formatDateToString(date);
            const data = await fetchCSVData();
            console.log("Formatted Date:", formattedDate); // Log the formatted date to check
            console.log("Agenda Data:", data); // Log the parsed agenda data

            // Find agenda for the date
            const todayAgenda = data.filter(item => item.date === formattedDate);
            const tableBody = document.querySelector("#agenda-table tbody");

            if (!tableBody) {
                console.error("Table body element not found!");
                return;
            }

            // Hide the loading spinner and show the table
            document.getElementById("loading").style.display = "none";
            document.getElementById("agenda-table").style.display = "table";
            document.getElementById("current-date").textContent = `Date: ${formattedDate}`;

            // Display agenda data or no agenda message
            tableBody.innerHTML = todayAgenda.length
                ? todayAgenda.map(item => `<tr><td>${item.date}</td><td>${item.agenda}</td></tr>`).join("")
                : `<tr><td colspan="2">No agenda for today.</td></tr>`;
        }

        // Navigation function
        function updateAgendaForDate(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            displayAgendaForDate(currentDate);
        }

        // Event listeners for navigation
        document.getElementById("prev-day").addEventListener("click", () => updateAgendaForDate(-1));
        document.getElementById("next-day").addEventListener("click", () => updateAgendaForDate(1));

        // Initial load
        window.onload = () => {
            displayAgendaForDate(currentDate);
        };
    </script>
</body>
</html>
